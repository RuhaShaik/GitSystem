<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <link href="css/kaleem_css.css" rel="stylesheet">
</head>
<style>
.new_head { 
    background-color: #131e35;
    color: #ffffff;
	padding:35px;
	}
.borderline{
	padding:30px;
	border:1px solid #474e5d;
}

td, tr, th {
    border: 1px solid black;
}
table {
    border-collapse: collapse;
    border-spacing: 0;
    width: 100%;
    border: 1px solid #ddd;
}
td, th {
    min-width: 50px;
    height: 21px;
	text-align: left;
    padding: 8px;
}

tr:nth-child(even){background-color: #f2f2f2}

span {
    width: 100%;
    display: block;
}

#topbar {
    background: black;
}
#topbar  ul li a {
    color: white;
    font-size: 14px;
}
#topbar ul li a:hover {
    color: #ef173c;
}
ul,li{
	list-style:none;		
}
li{
padding:15px;
}
#topbar  ul li {
    float: left;
}
#topbar .navback ul :hover {
   background-color:rgba(255,255,255,0.2);
}

</style>
<body>
<div class="container-fluid">
  
    <div class="row" style="margin:0; " id="topbar" >        
        <div class="col-md-6 ">
            <ul>
                <li><a > Abdul Kaleem, Ponnur, Guntur </a></li>
                <li><a >abdulkaleem@gmail.com</a></li>
                <li><a >+91 7732021542</a></li>
            </ul>			
        </div> 
		<div class="col-md-6 ">
			<div class="navback offset-md-6">
				<ul style="margin:0">
					<li ><a href="main.html">Home</a></li>
					<li><a>Customers</a></li>
				</ul>
			</div>			
        </div> 
    </div>   

<div class="new_head text-center">
	<h3>New Customer Details</h3>
	<hr width="45%">  
</div>
<div style="margin:50px;">
	<form id="form-valid" 	class="borderline" action="/action_page.php">
		<div class="row justify-content-center">
		<div class="form-group col-md-4">
			<label for="name">Customer Name:</label>
			<input type="text" class="form-control" id="name" placeholder="Enter customer name" name="name">
		</div>
		<div class="form-group col-md-4">
			<label for="pwd">Phone:</label>
			<input type="number" class="form-control" id="phone" placeholder="Enter phone number" name="phone">
		</div>
		<div class="form-group col-md-4">
			<label for="pwd">Address:</label>
			<input type="textarea" class="form-control" id="pwd" placeholder="Enter customer address" name="pswd">
		</div>			
		</div>		
	<h4 >Add Product details <a class="btn add-row">+</a></h4>
	<div style="overflow-x:auto;">
	<table id="product_details" >
		 <thead>
			<tr>
				<th>Item Description</th>
				<th>HSN code</th>				
				<th>Units</th>
				<th>Rate</th>
				<th>Amount</th>          
				<th>TaxbleValue</th>            
				<th>CGST Amt</th>            
				<th>SGST Amt</th>            
				<th>Total Amt</th>            
			</tr>
		</thead>
		<tbody>
			<tr>
				<td class="Item_Description" contenteditable="true" required></td>
				<td class="HSN_code"  contenteditable="true"></td>
				
				<td class="Units" contenteditable="true"></td>
				<td class="Rate" contenteditable="true"></td>
				<td class="Amount" contenteditable="true"></td>
				
				<td class="TaxbleValue" contenteditable="true"></td>
				<td class="CGST_Amt" contenteditable="true"></td>
				<td class="SGST_Amt" contenteditable="true"></td>
				<td class="Total_Amt"contenteditable="true"></td>
			</tr>
			<tr>            
				<td class="Item_Description" contenteditable="true"></td>
				<td class="HSN_code"  contenteditable="true"></td>
				
				<td class="Units" contenteditable="true"></td>
				<td class="Rate" contenteditable="true"></td>
				<td class="Amount" contenteditable="true"></td>
				
				<td class="TaxbleValue" contenteditable="true"></td>
				<td class="CGST_Amt" contenteditable="true"></td>
				<td class="SGST_Amt" contenteditable="true"></td>
				<td class="Total_Amt" contenteditable="true"></td>
			</tr>
			<tr>            
				<td class="Item_Description" contenteditable="true"></td>
				<td class="HSN_code"  contenteditable="true"></td>
				
				<td class="Units" contenteditable="true"></td>
				<td class="Rate" contenteditable="true"></td>
				<td class="Amount" contenteditable="true"></td>
				
				<td class="TaxbleValue" contenteditable="true"></td>
				<td class="CGST_Amt" contenteditable="true"></td>
				<td class="SGST_Amt" contenteditable="true"></td>
				<td class="Total_Amt" contenteditable="true"></td>
			</tr>
		</tbody>
	</table>
	</div>
	<div class="row " >
	<div class="col-*-*" style="margin:0 auto; padding-top:30px;" >
	<button type="button" class="btn btn-outline-success update_details" >Submit</button>
	<button type="button" class="btn btn-outline-info cancel">Cancel</button>	
	</div>
	
	</div>
	<p id="result"></p>
	</form>
</div>
</div>
 <script>
 //$(function(){});

$(document).ready(function(){
  //$( "#product_details tbody tr " ).focusout(function() {
	//$( this ).css( "background-color", "green" );
	//var x =$( this ).text();
	//var y=$( this ).find(".Amount");
	////alert(x);
	////$('.Units').text(x);
	//$(y).text(x);
  //})
   
	//$( "#product_details tbody tr " ).on( "keyup paste", function( event ) {
	//	//$( this ).css( "background-color", "green" );
	//	var x =$( this ).text();
	//	var y=$( this ).find(".Amount");
	//	//alert(x);
	//	//$('.Units').text(x);
	//	$(y).text(x);
	//});
	
	//$( " tbody tr " ).keypress(function() {
	//	var rowIndex = $(' tr').index(this);
	//	var x='';
	//	$(" .Rate").focusout(function() {			
	//		$( this ).css( "background-color", "green" );
	//		x = $( this ).text();
	//		//$("tr .Units").eq(rowIndex).text(x);
	//		$('tr ').find('.Units').eq(rowIndex-1).text(x);
	//			
	//	});
	//	//if(x!='')
	//	console.log(rowIndex+x);		
	//});
	$( " tbody tr .Item_Description" ).on ( "keypress",function() {
		$( this ).css( "background-color", "green" );
		var rowIndex = $(' tr').index(this);
		var x='';
		$(" .Item_Description").on ( "keypress",function() {			
			$( this ).css( "background-color", "green" );
			x = $( this ).text();
			//$("tr .Units").eq(rowIndex).text(x);
			$('tr ').find('.Units').eq(rowIndex-1).text(x);
				
		});
		//if(x!='')
		console.log(rowIndex+x);		
	});
});


 
 //window.location.reload();
$(".add-row").on("click",function(){
    var new_row='<tr>\
	<td class="Item_Description" contenteditable="true"></td>\
	<td class="HSN_code"  contenteditable="true"></td>\
	<td class="Units" contenteditable="true"></td>\
	<td class="Rate" contenteditable="true"></td>\
	<td class="Amount" contenteditable="true"></td>\
	<td class="TaxbleValue" contenteditable="true"></td>\
	<td class="CGST_Amt" contenteditable="true"></td>\
	<td class="SGST_Amt" contenteditable="true"></td>\
	<td class="Total_Amt" contenteditable="true"></td>\
	</tr>';            
	$("#product_details").append(new_row);
	//$("#form-valid").validator("update");		
});

///$( ".product_details tbody tr .Item_Description" ).on( "click change blur keyup paste input", function( event ) {
///$( ".product_details tbody tr .Item_Description" ).on( "keypress paste", function( event ) {
/// //var pickedup
/// //         // get back to where it was before if it was selected :
/// //         if (pickedup != null) {
/// //             pickedup.css( "background-color", "#ffccff" );
/// //         }
///			//alert($(this).html());
///			$(".Amount").data($(this).find("td").eq(1).html());
///          //$(".fillname").val($(this).find("td").eq(1).html());
///			$( this ).css( "background-color", "red" );
///			var x=$( this ).val();
///			console.log(x);
///			$('.Amount').text(x);
///        //  pickedup = $( this );
///});



       //$("#chatMessage").on('blur keyup paste input', function(){
       //// var start = this.selectionStart;
       //    $("#chatMessage").html($("#chatMessage").html().replace(regex, 
    	//			function (match) {
       //				return typeof emoticons[match] != 'undefined' ?
       //       				'<img src="'+url+emoticons[match]+'"/>' :
       //       				match;
     	//			}));
       // // this.selectionEnd = start;
       //    });
   


$(".update_details").on("click",function(){	
    var convertTableToJson = function()
    {	
        var rows = [];
		var x=1;
		var flag=1;
        $('table tr').each(function(i, n){
			//console.log(n);			
            var $row = $(n);
			if(x==1)
			{
				x++;
			}
			else{
				if($.trim($row.find('td:eq(0)').text())!=''){					
					//alert($.trim($row.find('td:eq(0)').text()));
					rows.push({
						Item_Description: $.trim($row.find('td:eq(0)').text()),
						HSN_code:  $.trim($row.find('td:eq(1)').text()),						
						Units:     $.trim($row.find('td:eq(3)').text()),  
						Rate:      $.trim($row.find('td:eq(4)').text()), 
						Amount:    $.trim($row.find('td:eq(5)').text()),						
						TaxbleValue:$.trim($row.find('td:eq(7)').text()),
						CGST_Amt:  $.trim($row.find('td:eq(8)').text()),
						SGST_Amt:  $.trim($row.find('td:eq(9)').text()),
						Total_Amt: $.trim($row.find('td:eq(10)').text()),				
					});
				}
				else{					
					//console.log($row.find('td:eq(0)').cellIndex);
					//var x = $(this).closest('tr').index();
					alert("please fill "+(x-1)+" row \n row not filled, so Re-enter after refresh");
					console.log(rows);
					//rows = [];
					//flag=0;
				}
				x++;
			}
        });
		//sendData();
		//console.log(rows);
		//return (rows);	
		//if(flag!=0)
		return JSON.stringify(rows);	
		//else
		//return 0;		
    };       		
	var json = convertTableToJson();
	console.log(json);
	//if(json!=0){
	alert("Data posted");
	$.ajax({
        url: "post.php",
        type: "POST",
        data: {json:json}, 
        success: function (data,success) {
			
			$('#result').html(data);
			//window.location.reload();			
		}
	});	
	//}
});
 </script>
</body>
</html>